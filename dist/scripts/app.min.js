
var loadingSteps=["Chargement de l'application","Récupération des données","Création de la zone de danger"];$("#preloader-text").text(loadingSteps[0]);var mymap=L.map('map').setView([48.6857475,5.6279968],2);var tileLayerUrl='https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';L.tileLayer(tileLayerUrl,{maxZoom:18,attribution:'Going to be offline attributions soon....'+'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, '+'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+'Imagery © <a href="http://mapbox.com">Mapbox</a>',id:'mapbox.streets'}).addTo(mymap);var marker=null;$("#preloader-text").text(loadingSteps[1]);$.get("/getGeojson",function(data,status){if(status!=='success'){alert('An error has occured');}
else if(status==='success'){$("#preloader-text").text(loadingSteps[2]);data.forEach(function(disease){diseaseToLayer(disease);});$("#preloader-wrapper").addClass("hidden");$("#app-wrapper").removeClass("hidden");}
return status==="success"});function diseaseToLayer(disease){console.log('disease',disease)
var diseaseStyle={"color":disease.color};if(disease.featuresCollection&&disease.featuresCollection.features){disease.featuresCollection.features.forEach(function(geojsonFeature){geojsonFeature.properties['diseaseName']=disease.name;geojsonFeature.properties['diseaseBeginDate']=disease.beginDate;geojsonFeature.properties['diseaseEndDate']=disease.endDate;geojsonFeature.properties['diseaseDuration']=disease.duration;geojsonFeature.properties['dieseaseRequiredTests']=disease.requiredTests;L.geoJSON(geojsonFeature,{style:diseaseStyle,onEachFeature:onEachFeature}).addTo(mymap);});}}
function onEachFeature(feature,layer){if(feature.properties&&feature.properties.sovereignt){layer.on('click',function(e){console.log('You just clicked on ',feature.properties.sovereignt);$("#admissiblity").text('Non admissible');$("#diseaseName").text(feature.properties.diseaseName)
$("#diseaseDuration").text(feature.properties.diseaseDuration)
$("#dieseaseRequiredTests").text(feature.properties.dieseaseRequiredTests)
$("#notAdmissible").removeClass("hidden");});}}
function onMapClick(e){console.log('You just clicked on ',e);if(marker===null){marker=L.marker(e.latlng).addTo(mymap);}else{marker.setLatLng(e.latlng);}
marker.addTo(mymap);}
mymap.on('click',onMapClick);